<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>TEST - Encuadre del Mapa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body {
      height: 100vh; width: 100vw; margin: 0; padding: 0; background: #0b1021;
    }
    #map { width: 100vw; height: 100vh; }
    
    #controls {
      position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
      z-index: 2000; background: rgba(11, 16, 33, 0.95);
      border: 2px solid #13f5ff; border-radius: 12px; padding: 15px;
      color: #fff; font-family: 'Consolas', monospace;
      max-width: 500px;
    }
    #info {
      margin-top: 10px; font-size: 0.9em; color: #13f5ff;
      background: rgba(19, 245, 255, 0.1); padding: 10px; border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <div id="controls">
    <h3 style="margin: 0 0 10px 0; color: #13f5ff;">üß™ TEST - Ajusta el Encuadre Perfecto</h3>
    <div style="background: rgba(76, 175, 80, 0.15); padding: 10px; border-radius: 6px; font-size: 0.85em; line-height: 1.6; border: 1px solid #4caf50;">
      ‚ú® <strong>MODO LIBRE:</strong><br>
      üîÑ Mundo infinito (sin l√≠mites laterales)<br>
      üîç Zoom ULTRA fino (pasos de 0.01)<br>
      üéÆ <strong>Arrastra y zoom</strong> con precisi√≥n<br>
      üì∏ <strong>Copia coordenadas</strong> cuando est√© perfecto
    </div>
    <div style="margin-top: 10px;">
      <button onclick="toggleNoWrap()" style="padding: 10px; width: 100%; background: #ff6b6b; border: 2px solid #ff6b6b; color: #fff; cursor: pointer; border-radius: 8px; font-weight: bold;">
        üîÑ Cambiar a noWrap: <span id="nowrap-status">true</span>
      </button>
      <div style="font-size: 0.75em; margin-top: 5px; color: #888;">
        (Prueba c√≥mo se ve con/sin repetici√≥n del mundo)
      </div>
    </div>
    <div id="info">
      <strong>Centro:</strong> [35.0000, 15.0000]<br>
      <strong>Zoom:</strong> 3.00<br>
      <strong>noWrap:</strong> <span id="current-nowrap">false</span>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', {
      zoomControl: true,
      attributionControl: false,
      minZoom: 1,
      maxZoom: 17,
      scrollWheelZoom: true,
      dragging: true,
      zoomSnap: 0.01,
      zoomDelta: 0.01,
      wheelPxPerZoomLevel: 300,
      noWrap: false,
      worldCopyJump: true
    });

    map.setView([35, 15], 3);
    
    console.log('‚ú® MODO LIBRE TOTAL:');
    console.log('  noWrap: false (mundo infinito)');
    console.log('  Sin maxBounds (movimiento lateral libre)');
    console.log('  Zoom ULTRA fino (pasos de 0.01 - m√°xima precisi√≥n)');
    console.log('  üéÆ Ajusta con precisi√≥n y dame las coordenadas perfectas');

    // Mapa base oscuro - CON REPETICI√ìN
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 19, minZoom: 1, noWrap: false
    }).addTo(map);

    // Capa GPS - CON REPETICI√ìN
    L.tileLayer('https://gps-{s}.tile.openstreetmap.org/lines/{z}/{x}/{y}.png', {
      maxZoom: 19, minZoom: 1, opacity: 0.85, noWrap: false
    }).addTo(map);

    // L√≠neas de zonas horarias (para referencia)
    for(let i = -12; i <= 14; i++) {
      const lon = i * 15;
      if (lon < -180 || lon > 180) continue;
      L.polyline([[-59.98, lon], [82.26, lon]], {
        color: "#2cfdff", weight: 2, opacity: 0.5, dashArray: "5,14"
      }).addTo(map);
    }

    let currentNoWrap = false;
    let baseLayer, gpsLayer;

    // Guardar referencias a las capas
    map.eachLayer(function(layer) {
      if (layer._url && layer._url.includes('basemaps')) baseLayer = layer;
      if (layer._url && layer._url.includes('gps')) gpsLayer = layer;
    });

    function toggleNoWrap() {
      currentNoWrap = !currentNoWrap;
      
      // Actualizar status
      document.getElementById('nowrap-status').textContent = currentNoWrap ? 'false' : 'true';
      document.getElementById('current-nowrap').textContent = currentNoWrap;
      
      // Recrear capas con nuevo noWrap
      if (baseLayer) map.removeLayer(baseLayer);
      if (gpsLayer) map.removeLayer(gpsLayer);
      
      baseLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19, minZoom: 1, noWrap: currentNoWrap
      }).addTo(map);
      
      gpsLayer = L.tileLayer('https://gps-{s}.tile.openstreetmap.org/lines/{z}/{x}/{y}.png', {
        maxZoom: 19, minZoom: 1, opacity: 0.85, noWrap: currentNoWrap
      }).addTo(map);
      
      console.log(`üîÑ Cambiado a noWrap: ${currentNoWrap} ${currentNoWrap ? '(sin repetici√≥n)' : '(infinito)'}`);
      updateInfo();
    }

    function updateInfo() {
      const center = map.getCenter();
      const zoom = map.getZoom();
      document.getElementById('info').innerHTML = 
        `<strong>Centro:</strong> [${center.lat.toFixed(4)}, ${center.lng.toFixed(4)}]<br>` +
        `<strong>Zoom:</strong> ${zoom.toFixed(2)}<br>` +
        `<strong>noWrap:</strong> <span id="current-nowrap">${currentNoWrap}</span>`;
      console.log(`üìç Centro: [${center.lat.toFixed(4)}, ${center.lng.toFixed(4)}], Zoom: ${zoom.toFixed(2)}, noWrap: ${currentNoWrap}`);
    }

    // Actualizar info en tiempo real
    map.on('moveend zoomend', updateInfo);

    console.log('üß™ TEST DE ENCUADRE - MODO INFINITO');
    console.log('üéÆ Arrastra y haz zoom hasta que se vea perfecto');
    console.log('üîÑ Usa el bot√≥n para probar con noWrap true/false');
    console.log('üìç Las coordenadas se actualizan autom√°ticamente');
    console.log('üì∏ Copia las coordenadas cuando est√© perfecto');
    
    // Trigger inicial
    updateInfo();
  </script>
</body>
</html>
