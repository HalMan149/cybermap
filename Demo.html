<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo Gradiente Ataques Países</title>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<style>
  #map { height: 90vh; width: 100%; }
  .legend {
    background: white;
    padding: 6px 8px;
    font: 14px Arial, sans-serif;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
  }
  .legend i {
    width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7;
  }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Mapa base
const map = L.map('map').setView([20, 0], 2);

// Capa base OpenStreetMap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Datos GeoJSON de países (usa tu countries.geojson local o remoto)
fetch('countries.geojson')
  .then(res => res.json())
  .then(geojson => {
    // Datos ataques ejemplo (usa los datos reales que tienes)
    const ataquesPorPais = {
      "US": 3,
      "FR": 2,
      "DE": 1,
      "GB": 1,
      "CN": 2,
      "BR": 1,
      "JP": 1,
      "RU": 1
    };

    // Función para color según número ataques
    function getColor(d) {
      return d > 20 ? '#800026' :
             d > 10 ? '#BD0026' :
             d > 5  ? '#E31A1C' :
             d > 2  ? '#FC4E2A' :
             d > 0  ? '#FD8D3C' :
                      '#f0f0f0';
    }

    // Estilo con color y opacidad según ataques
    function style(feature) {
      const iso = (feature.properties["ISO3166-1-Alpha-2"] || "").toUpperCase();
      const ataques = ataquesPorPais[iso] || 0;
      return {
        fillColor: getColor(ataques),
        weight: 1,
        color: '#444',
        fillOpacity: ataques > 0 ? 0.7 : 0.1
      };
    }

    // Mostrar tooltip con nombre y ataques
    function onEachFeature(feature, layer) {
      const iso = (feature.properties["ISO3166-1-Alpha-2"] || "").toUpperCase();
      const ataques = ataquesPorPais[iso] || 0;
      layer.bindTooltip(`${feature.properties.ADMIN}: ${ataques} ataques`);
    }

    L.geoJSON(geojson, { style, onEachFeature }).addTo(map);

    // Leyenda simple
    const legend = L.control({position: 'bottomleft'});
    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      const grades = [0, 1, 3, 5, 10, 20];
      const labels = ['Ninguno', 'Bajo', 'Medio', 'Alto', 'Muy alto', 'Extremo'];
      div.innerHTML = '<b>Intensidad ataques</b><br>';
      for (let i = 0; i < grades.length; i++) {
        div.innerHTML +=
          `<i style="background:${getColor(grades[i] + 1)}"></i> ${labels[i]}<br>`;
      }
      return div;
    };
    legend.addTo(map);
  })
  .catch(e => console.error('Error cargando GeoJSON:', e));
</script>
</body>
</html>
