<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo mapa choropleth realista</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
<style>
  #map { width: 100vw; height: 100vh; }
  .info { padding: 6px 8px; background: black; color: white; font: 14px Arial, sans-serif; }
  .legend { line-height: 18px; color: #555; background: white; padding: 6px 8px; }
  .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<script>
// Datos reales de ataques simplificados para demo
const ataques = [
  { country: "US" }, { country: "US" }, { country: "US" },
  { country: "FR" }, { country: "FR" },
  { country: "DE" },
  { country: "GB" },
  { country: "CN" }, { country: "CN" },
  { country: "BR" },
  { country: "JP" },
  { country: "RU" }
];

// Contar ataques por país
const ataquesPorPais = ataques.reduce((acc, cur) => {
  acc[cur.country] = (acc[cur.country] || 0) + 1;
  return acc;
}, {});
const maxAtaques = Math.max(...Object.values(ataquesPorPais));

console.log('Ataques por país:', ataquesPorPais, 'Máximo ataques:', maxAtaques);

// Función de color dinámica
function getColor(d, max) {
  if (d === 0) return '#f0f0f0';
  const ratio = d / max;
  if (ratio > 0.75) return '#d73027';
  if (ratio > 0.5)  return '#fc8d59';
  if (ratio > 0.25) return '#fee08b';
  return '#ffffbf';
}

// Crear mapa Leaflet
const map = L.map('map').setView([20, 0], 2);

// Capa base
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 5,
  attribution: '© OpenStreetMap'
}).addTo(map);

// Cargar GeoJSON países (usa tu archivo countries.geojson)
// Para demo, uso fetch desde URL pública de ejemplo
fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
  .then(res => res.json())
  .then(geojson => {
    // Añadir capa con estilo dinámico
    L.geoJSON(geojson, {
      style: feature => {
        const iso = feature.properties.ISO_A2 || feature.properties.ISO2 || feature.properties.ISO3166_1_Alpha_2 || '';
        const ataques = ataquesPorPais[iso] || 0;
        return {
          fillColor: getColor(ataques, maxAtaques),
          weight: 1,
          color: '#444',
          fillOpacity: 0.7,
        };
      },
      onEachFeature: (feature, layer) => {
        const iso = feature.properties.ISO_A2 || feature.properties.ISO2 || feature.properties.ISO3166_1_Alpha_2 || '';
        const ataques = ataquesPorPais[iso] || 0;
        layer.bindTooltip(`${feature.properties.ADMIN}: ${ataques} ataque(s)`);
      }
    }).addTo(map);
  });
</script>
</body>
</html>
