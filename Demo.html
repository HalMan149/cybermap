fetch('countries.geojson')
  .then(res => res.json())
  .then(geojson => {
    const geoFeatures = geojson.features;
    console.log('Total países en GeoJSON:', geoFeatures.length);

    geoFeatures.forEach(feature => {
      // Usa el campo correcto ISO3166-1-Alpha-2, asegurando mayúsculas
      const iso = (feature.properties["ISO3166-1-Alpha-2"] || "").toUpperCase();
      const ataques = ataquesPorPais[iso] || 0;

      console.log(`País: ${feature.properties.ADMIN}, ISO: ${iso}, Ataques detectados: ${ataques}`);
    });

    L.geoJSON(geojson, {
      style: feature => {
        const iso = (feature.properties["ISO3166-1-Alpha-2"] || "").toUpperCase();
        const ataques = ataquesPorPais[iso] || 0;
        return {
          fillColor: ataques > 0 ? '#f03b20' : '#f0f0f0',
          weight: 1,
          color: '#444',
          fillOpacity: 0.7,
        };
      },
      onEachFeature: (feature, layer) => {
        const iso = (feature.properties["ISO3166-1-Alpha-2"] || "").toUpperCase();
        const ataques = ataquesPorPais[iso] || 0;
        layer.bindTooltip(`${feature.properties.ADMIN}: ${ataques} ataques`);
      }
    }).addTo(map);
  })
  .catch(e => console.error('Error al cargar GeoJSON:', e));
