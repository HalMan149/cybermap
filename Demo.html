<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Demo gradiente países</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body { height:100vh; margin:0; padding:0; }
    #map { width:100vw; height:100vh; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map', { attributionControl: false }).setView([20, 0], 2.2);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      maxZoom: 19, minZoom: 2, noWrap: true
    }).addTo(map);

    // Ejemplo: ataques ficticios (puedes cambiarlos)
    const ataquesPorPais = {
      "US": 12,
      "FR": 6,
      "GB": 8,
      "DE": 3,
      "ES": 9,
      "CN": 4,
      "RU": 2,
      "BR": 7,
      "IN": 3,
      "IT": 5,
      "JP": 1,
      "CA": 1,
      "AR": 2,
      "AU": 4
    };

    let geojsonLayer;
    async function pintarMapaChoropleth(ataquesPorPais) {
      if (geojsonLayer) map.removeLayer(geojsonLayer);
      const resp = await fetch('/countries.geojson'); // Debe estar en la raíz
      const worldGeo = await resp.json();
      const maxAtaques = Math.max(...Object.values(ataquesPorPais), 1);

      geojsonLayer = L.geoJSON(worldGeo, {
        style: feature => {
          const code = feature.properties.ISO_A2 ? feature.properties.ISO_A2.toUpperCase() : null;
          const n = code ? (ataquesPorPais[code] || 0) : 0;
          let color;
          if (!code) color = "#26292f";
          else if (n === 0) color = "#22242a";
          else if (n === maxAtaques) color = "#ff0066";
          else color = `hsl(${220 - Math.round((n / maxAtaques) * 180)}, 100%, 55%)`;
          return {
            fillColor: color,
            fillOpacity: !code ? 0.03 : (n === 0 ? 0.07 : 0.21 + 0.37 * (n / maxAtaques)),
            color: "#25efff",
            weight: 1.3,
            opacity: 0.6
          };
        }
      }).addTo(map);
    }
    pintarMapaChoropleth(ataquesPorPais);
  </script>
</body>
</html>
